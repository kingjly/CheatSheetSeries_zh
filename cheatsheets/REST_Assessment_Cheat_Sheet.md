# REST 评估备忘录

## 关于 RESTful Web 服务

Web 服务是用于机器间通信的 Web 技术实现。因此，它们用于应用间通信、Web 2.0 和混搭（Mashups），以及桌面和移动应用调用服务器。

RESTful Web 服务（通常简称为 REST）是基于 RESTful 设计模式的轻量级 Web 服务变体。实际上，RESTful Web 服务利用 HTTP 请求，这些请求类似于常规 HTTP 调用，与使用复杂协议的其他 Web 服务技术（如 SOAP）形成对比。

## RESTful Web 服务的关键相关属性

- 使用 HTTP 方法（`GET`、`POST`、`PUT` 和 `DELETE`）作为请求操作的主要动词。
- 非标准参数规范：
    - 作为 URL 的一部分。
    - 在请求头中。
- 使用 JSON 或 XML 在参数值、请求体或响应体中构建参数和响应。这些是传递机器可用信息所必需的。
- 自定义身份验证和会话管理，通常利用自定义安全令牌：这是必需的，因为机器间通信不允许登录序列。
- 缺乏正式文档。由 Sun Microsystems 提交的描述 RESTful Web 服务的[拟议标准 WADL](http://www.w3.org/Submission/wadl/)从未正式采用。

## RESTful Web 服务安全测试的挑战

- 检查应用程序无法揭示攻击面，即 RESTful Web 服务使用的 URL 和参数结构。原因包括：
    - 没有应用程序会使用服务公开的所有可用功能和参数。
    - 这些功能通常由客户端代码动态激活，而不是页面中的链接。
    - 客户端应用程序通常不是 Web 应用程序，不允许检查激活链接或相关代码。
- 参数是非标准的，难以确定什么是 URL 的一部分或常量请求头，什么是值得[模糊测试](https://owasp.org/www-community/Fuzzing)的参数。
- 作为机器接口，使用的参数数量可能非常大，例如 JSON 结构可能包含数十个参数。[模糊测试](https://owasp.org/www-community/Fuzzing)每个参数会显著延长测试所需的时间。
- 自定义身份验证机制需要逆向工程，使得流行工具无法跟踪登录会话。

## 如何渗透测试 RESTful Web 服务

通过文档确定攻击面 - 如果允许某种程度的白盒测试并且可以获取服务信息，RESTful 渗透测试可能会更好。

这些信息将确保更全面地覆盖攻击面。要查找的信息包括：

- 正式服务描述 - 对于其他类型的 Web 服务（如 SOAP），通常可以获得 WSDL 形式的正式描述，但对于 REST 很少如此。尽管如此，WSDL 2.0 或 WADL 有时仍可描述 REST。
- 服务使用开发者指南可能不太详细，但通常可以找到，甚至可以被视为*半透明盒*测试。
- 应用程序源代码或配置 - 在许多框架中，包括 .NET，REST 服务定义可能更容易从配置文件而非代码中获取。

使用[代理](https://www.zaproxy.org/)收集完整请求 - 虽然这始终是重要的渗透测试步骤，但对于基于 REST 的应用程序尤为重要，因为应用程序 UI 可能不会提供关于实际攻击面的线索。

注意，代理必须能够收集完整请求，而不仅仅是 URL，因为 REST 服务使用的不仅仅是 GET 参数。

分析收集的请求以确定攻击面：

- 查找非标准参数：
    - 查看异常的 HTTP 请求头 - 这些通常是基于请求头的参数。
    - 确定 URL 段是否在 URL 间有重复模式。这些模式可能包括日期、数字或类似 ID 的字符串，表明 URL 段是嵌入式参数。
        - 例如：`http://server/srv/2013-10-21/use.php`
    - 查找结构化参数值 - 这些可能是 JSON、XML 或非标准结构。
    - 如果 URL 的最后一个元素没有扩展名，它可能是一个参数。如果应用程序技术通常使用扩展名，或者前一个段有扩展名，这一点尤其明显。
        - 例如：`http://server/svc/Grid.asmx/GetRelatedListItems`
    - 查找高度变化的 URL 段 - 单个 URL 段有多个值可能意味着它是参数而非物理目录。
        - 例如，如果 URL `http://server/src/XXXX/page` 以 `XXXX` 的数百个值重复，那么 `XXXX` 很可能是参数。

验证非标准参数：在某些情况下（但并非所有情况），将被怀疑为参数的 URL 段设置预期无效的值可以帮助确定它是路径元素还是参数。如果是路径元素，Web 服务器将返回 *404* 消息；而对于参数的无效值，响应将是应用程序级别的消息，因为该值在 Web 服务器级别是合法的。

分析收集的请求以优化[模糊测试](https://owasp.org/www-community/Fuzzing) - 在识别潜在的模糊测试参数后，分析每个参数的收集值以确定：

- 有效与无效值，以便[模糊测试](https://owasp.org/www-community/Fuzzing)可以专注于边界无效值。
    - 例如，对于总是正整数的值发送 *0*。
- 允许超出当前用户分配范围进行模糊测试的序列。

最后，在[模糊测试](https://owasp.org/www-community/Fuzzing)时，不要忘记模拟所使用的身份验证机制。

## 相关资源

- [REST 安全备忘录](REST_Security_Cheat_Sheet.md) - 这个备忘录的另一面
- [YouTube: RESTful 服务，Web 安全盲点](https://www.youtube.com/watch?v=pWq4qGLAZHI) - 详细阐述本备忘录大部分主题的视频演示。
