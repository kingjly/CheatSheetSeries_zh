# 用户隐私保护备忘录

## 引言

这份 OWASP 备忘录介绍了 Web 开发者可以利用的缓解方法，以保护用户免受可能破坏其隐私和匿名性的广泛潜在威胁和侵犯。这份备忘录重点关注用户在使用在线服务时可能面临的隐私和匿名性威胁，尤其是在社交网络和通信平台等环境中。

## 指南

### 强密码学

任何处理用户身份、私人信息或通信的在线平台都必须使用强密码学进行保护。用户通信必须在传输和存储过程中加密。用户密码等秘密信息必须使用强大的、防碰撞的哈希算法和不断增加的工作因子进行保护，以大大降低凭据泄露的风险并确保适当的完整性控制。

为保护传输中的数据，开发者必须使用和遵循 TLS/SSL 最佳实践，如经过验证的证书、充分保护的私钥、仅使用强密码、对用户的信息性和清晰警告，以及足够的密钥长度。私人数据必须使用具有足够长度的密钥在严格的技术和程序访问条件下进行加密。无论是否在存储中加密，用户凭据都必须进行哈希处理。

有关强密码学和最佳实践的详细指南，请阅读以下 OWASP 参考资料：

1. [密码存储备忘录](Cryptographic_Storage_Cheat_Sheet.md)。
2. [身份验证备忘录](Authentication_Cheat_Sheet.md)。
3. [传输层安全备忘录](Transport_Layer_Security_Cheat_Sheet.md)。
4. [密码学指南](https://wiki.owasp.org/index.php/Guide_to_Cryptography)。
5. [测试 TLS/SSL](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/01-Testing_for_Weak_SSL_TLS_Ciphers_Insufficient_Transport_Layer_Protection.html)。

### 支持 HTTP 严格传输安全

HTTP 严格传输安全（HSTS）是服务器设置的 HTTP 标头，向用户代理指示仅接受安全（HTTPS）连接，提示用户代理将所有不安全的 HTTP 链接更改为 HTTPS，并强制兼容的用户代理通过拒绝任何未被用户信任的 TLS/SSL 连接来进行故障安全。

HSTS 在 Mozilla Firefox 和 Google Chrome 等流行用户代理中有平均支持率。尽管如此，对于那些持续担心间谍活动和中间人攻击的用户来说，它仍然非常有用。

如果对所有用户强制执行 HSTS 不切实际，Web 开发者应该至少给用户选择启用它的选项。

有关 HSTS 的更多详细信息，请访问：

1. [维基百科中的 HTTP 严格传输安全](https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security)。
2. [HSTS RFC](https://tools.ietf.org/html/rfc6797)。
3. [OWASP Appsec 教程系列 - 第 4 集：严格传输安全](http://www.youtube.com/watch?v=zEV3HOuM_Vw)。

### 数字证书固定

证书固定是在用户代理（无论是 Web 浏览器、移动应用还是浏览器插件）中硬编码或存储预定义的数字证书/公钥信息集（通常是哈希值）的做法，使得仅使用预定义的证书/公钥进行安全通信，而所有其他证书/公钥都将失败，即使用户（隐式或显式）信任其他证书/公钥。

固定的一些优势包括：

- 在证书颁发机构（CA）被入侵的情况下，被入侵的 CA 可以为任何域颁发证书，从而允许邪恶的肇事者窃听用户通信。
- 在用户被迫接受潜在恶意根 CA 的环境中，如企业环境或国家公钥基础设施（PKI）方案。
- 在目标用户群可能不理解证书警告并可能允许任何无效证书的应用程序中。

有关证书固定的详细信息，请参考以下资料：

1. [OWASP 证书固定备忘录](Pinning_Cheat_Sheet.md)。
2. [HTTP 公钥固定扩展 RFC](https://tools.ietf.org/html/rfc7469)。
3. [通过 Tobias Gondrom 防御中间人攻击保护 SSL 通道：未来技术 - HTTP 严格传输安全和证书固定](https://owasp.org/www-pdf-archive/OWASP_defending-MITMA_APAC2012.pdf)。

### 紧急模式

紧急模式是受威胁用户在面临直接威胁要求披露账户凭据时可以使用的模式。

让用户能够创建紧急模式可以帮助他们在这些威胁中生存，尤其是在世界上动荡的地区。不幸的是，世界上许多用户面临着大多数 Web 开发者不了解或未考虑到的威胁类型。

紧急模式的示例包括受到威胁时删除数据的模式、登录虚假收件箱/账户/系统，或触发备份/上传/隐藏敏感数据。

要实施的适当紧急模式取决于应用程序类型。像 VeraCrypt 这样的磁盘加密软件可能实施一个紧急模式，在用户输入受胁密码时启动一个虚假系统分区。

电子邮件提供商可能实施一个隐藏预定义敏感电子邮件或联系人的紧急模式，仅允许阅读无害的电子邮件消息，通常由用户定义，同时防止紧急模式接管实际账户。

关于紧急模式的重要注意事项是它们不应易于被发现。对手进入受害者的紧急模式后，必须尽可能少地发现真相。这意味着进入紧急模式后，必须允许继续大多数非敏感的正常操作，并且可以从原始紧急模式内部创建进一步的紧急模式（如果对手试图在受害者的紧急模式上创建紧急模式并失败，对手将知道他们已经在紧急模式中，并可能试图伤害受害者）。

另一种解决方案是防止从用户账户生成紧急模式，而是使其对对手更难伪造。例如，它可能只能带外创建，并且对手必须无法知道特定账户是否已存在紧急模式。

紧急模式的实施必须始终旨在混淆对手，防止他们访问受害者的实际账户/敏感数据，并防止发现特定账户的任何现有紧急模式。

有关 VeraCrypt 隐藏操作系统模式的更多详细信息，请参考：

- [VeraCrypt 隐藏操作系统](https://www.veracrypt.fr/en/Hidden%20Operating%20System.html)。

### 远程会话失效

在用户设备丢失、被盗或被没收，或者怀疑 Cookie 被盗的情况下，让用户能够查看当前在线会话并断开/使任何可疑的残留会话失效可能非常有益，尤其是那些属于被盗或被没收设备的会话。如果用户怀疑其会话详细信息在中间人攻击中被窃取，远程会话失效也会有所帮助。

有关会话管理的详细信息，请参考：

- [OWASP 会话管理备忘录](Session_Management_Cheat_Sheet.md)。

### 允许来自匿名网络的连接

匿名网络（如 Tor 项目）为世界各地动荡地区的用户提供了逃避监视、获取信息或突破审查障碍的绝佳机会。通常，动荡地区的活动人士使用这些网络报告不公正或向世界其他地方发送未经审查的信息，尤其是社交网络、媒体流媒体网站和电子邮件提供商。

Web 开发者和网络管理员必须追求每一个途径，使用户能够从这些网络后面访问服务，并且针对此类匿名网络的任何政策都需要仔细重新评估其对世界各地人们的影响。

如果可能，应用程序开发者应尝试集成或实现与这些匿名网络的轻松耦合，例如支持 SOCKS 代理或集成库（如 Android 的 OnionKit）。

有关匿名网络及其提供的用户保护的更多信息，请参考：

1. [Tor 项目](https://www.torproject.org)。
2. [I2P 网络](http://www.i2p2.de)。
3. [OnionKit：增强 Android 应用的网络安全和加密](https://github.com/guardianproject/OnionKit)。

### 防止 IP 地址泄露

防止用户 IP 地址泄露对于用户保护至关重要。任何托管外部第三方内容（如头像、签名或照片附件）的应用程序都必须考虑允许用户阻止第三方内容加载到应用程序页面的好处。

如果可以嵌入第三方、外部域图像，例如在用户的信息流或时间线中，攻击者可能通过在其域上托管图像并监视该图像的 HTTP 请求来发现受害者的真实 IP 地址。

许多 Web 应用程序需要用户内容才能运行，这作为业务流程是完全可以接受的；但是，Web 开发者建议考虑给用户阻止外部内容的选项作为预防措施。这主要适用于社交网络和论坛，但也可适用于基于 Web 的电子邮件，其中图像可以嵌入在 HTML 格式的电子邮件中。

HTML 格式的电子邮件中包含第三方图像存在类似问题，但大多数电子邮件客户端和提供商默认阻止加载第三方内容；这为用户提供了更好的隐私和匿名性保护。

### 诚实与透明

如果 Web 应用程序无法为用户提供足够的法律或政治保护，或者无法防止敏感信息（如日志）被滥用或披露，则必须以清晰、易懂的形式告诉用户真相，以便用户可以就是否应使用该特定服务做出明智的选择。

如果不违反法律，请告知用户外部实体是否正在请求删除或调查他们的信息。

诚实有助于在 Web 应用程序和其用户之间培养信任文化，并允许世界各地的许多用户仔细权衡他们的选择，从而防止在不同地区的用户遭受伤害。

有关安全日志记录的更多见解，请参见：

- [OWASP 日志记录备忘录](Logging_Cheat_Sheet.md)

## 参考资料

- [CWE 条目 601：开放重定向](http://cwe.mitre.org/data/definitions/601.html)。
- [WASC 文章：URL 重定向器滥用](http://projects.webappsec.org/w/page/13246981/URL%20Redirector%20Abuse)。
- [Google 博客文章：开放重定向的危险](http://googlewebmastercentral.blogspot.com/2009/01/open-redirect-urls-is-your-site-being.html)。
- [防止开放重定向攻击（C\#）](http://www.asp.net/mvc/tutorials/security/preventing-open-redirection-attacks)。
