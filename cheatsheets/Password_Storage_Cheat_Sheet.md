# 密码存储安全备忘录

## 简介

本指南旨在指导如何安全地存储用于身份验证的密码。即使应用程序或数据库被攻击，存储的密码也必须得到保护。

### 核心建议

- **首选 Argon2id**：使用至少 19 MiB 内存、2 次迭代和 1 个并行度
- **备选 scrypt**：最小 CPU/内存成本参数为 (2^17)
- **遗留系统使用 bcrypt**：工作因子 10 或更高，密码限制 72 字节
- **FIPS-140 合规**：使用 PBKDF2，工作因子 600,000 或更高
- **考虑使用 pepper 提供深度防御**

## 哈希 vs 加密

### 关键区别

- **哈希**：单向函数，无法还原原始密码
- **加密**：双向函数，可以解密获取原始密码

**密码应始终使用哈希，而非加密**。

## 密码存储增强方法

### 加盐（Salting）

- 为每个密码生成唯一随机字符串
- 使攻击者难以预计算哈希值
- 现代哈希算法（如 Argon2id）自动处理加盐

### Pepper

- 额外的安全层
- 不存储在数据库中
- 应存储在安全的秘密存储中

### 工作因子

- 控制哈希计算的计算成本
- 平衡安全性和性能
- 建议哈希计算时间少于 1 秒

## 推荐密码哈希算法

### Argon2id

**推荐配置**：
- m=19456 (19 MiB)
- t=2
- p=1

### scrypt

**推荐配置**：
- N=2^17 (128 MiB)
- r=8
- p=1

### bcrypt

**注意事项**：
- 仅用于遗留系统
- 工作因子最小为 10
- 密码长度限制 72 字节

### PBKDF2

**推荐配置**：
- HMAC-SHA-256
- 600,000 次迭代

## 升级遗留哈希

### 升级方法

1. 用户登录时重新哈希密码
2. 使用新算法重新哈希旧哈希值
3. 要求用户重置密码

### 国际字符支持

- 支持 Unicode 全范围字符
- 保留密码熵
- 处理包含空字节的输入

## 安全最佳实践

1. 使用现代哈希算法
2. 实施加盐和 pepper
3. 定期调整工作因子
4. 支持国际字符
5. 保护哈希存储
6. 监控和更新哈希技术

## 参考资源

- [NIST 密码指南](https://pages.nist.gov/800-63-3/sp800-63b.html)
- [密码哈希竞赛](https://en.wikipedia.org/wiki/Password_Hashing_Competition)
- [密码存储公共资源](https://pulse.michalspacek.cz/passwords/storages)

## 警告

- 不要使用 MD5、SHA-1 等快速哈希算法
- 避免在没有充分理由的情况下自定义哈希方法
- 定期审查和更新密码存储机制
