# 漏洞披露备忘录

## 引言

本备忘录旨在为安全研究人员和组织提供漏洞披露流程的指导。这是一个需要高度协作的领域，但往往会导致双方之间产生冲突。

**[研究人员](#报告漏洞)应该：**

- 确保任何测试都是合法且经授权的。
- 尊重他人的隐私。
- 尽合理努力联系组织的安全团队。
- 提供足够的细节以允许验证和重现漏洞。
- 不要在既定的漏洞赏金计划之外要求支付或奖励。

**[组织](#接收漏洞报告)应该：**

- 为研究人员提供安全报告漏洞的明确方法。
- 明确建立任何漏洞赏金计划的范围和条款。
- 在合理的时间线内响应报告。
- 与研究人员公开沟通。
- 不要威胁研究人员采取法律行动。
- 在适当时请求 CVE。
- 发布明确的安全公告和变更日志。
- 提供奖励和致谢。

## 披露方法

下面列出了披露漏洞时可以遵循的几种不同模型。

### 私密披露

在私密披露模型中，漏洞被私下报告给组织。组织可以选择发布漏洞详情，但这由组织自行决定，而非研究人员，这意味着许多漏洞可能永远不会公开。大多数漏洞赏金计划要求研究人员遵循这种模型。

这种模型的主要问题是，如果供应商无响应或决定不修复漏洞，则详情可能永远不会公开。从历史上看，这导致研究人员对公司忽视和试图隐藏漏洞感到沮丧，从而转向全面披露方法。

### 全面披露

在全面披露方法中，漏洞的全部细节一经识别就立即公开。这意味着完整细节（有时包括利用代码）对攻击者可用，通常在补丁可用之前。全面披露方法主要用于响应或组织忽视已报告的漏洞，以施加压力促使其开发和发布修复。

这使得全面披露方法极具争议，并被许多人视为不负责任。通常应仅在所有其他方法失败，或利用代码已公开可用时作为最后手段考虑。

### 负责任或协调披露

负责任披露试图在这两种方法之间找到合理的中间立场。在负责任披露中，初始报告是私下进行的，但一旦补丁可用（有时会延迟以允许更多时间安装补丁），就会公开全部细节。

在许多情况下，研究人员还会为组织设置响应报告或提供补丁的截止日期。如果未满足此截止日期，研究人员可能采用全面披露方法，并发布全部细节。

谷歌的 [Project Zero](https://googleprojectzero.blogspot.com/2020/01/policy-and-disclosure-2020-edition.html) 采用类似方法，无论组织是否发布补丁，都会在 90 天后公开漏洞的全部细节。

## 报告漏洞

本节旨在为安全研究人员提供如何向组织报告漏洞的指导。

### 警告和合法性

在进行任何安全研究或报告漏洞之前，**确保了解并理解您所在司法管辖区的法律**。本备忘录**不构成法律建议，不应被视为法律建议**。

以下几点突出了应考虑的一些领域：

- 如果您在漏洞赏金或类似计划下进行测试，组织可能已建立[安全港](https://disclose.io)政策，允许您合法地进行测试，**只要您遵守其计划的范围和规则**。仔细阅读范围 - 超出范围和规则可能构成刑事犯罪。
- 某些国家/地区有限制反向工程的法律，因此对本地安装的软件进行测试可能不被允许。
- 不要以提供安全漏洞信息为条件要求付款或其他奖励，或交换不公开详情或不向行业监管机构报告，因为这可能构成敲诈。
- 如果收到漏洞赏金付款，通常被视为收入，这意味着可能需要缴税。报告此收入并确保支付适当税款是**您的**责任。
- 如果您作为工作的一部分或在雇主拥有的设备上发现漏洞，雇主可能会阻止您报告这些漏洞或申请漏洞赏金。在这样做之前，请仔细阅读合同并考虑寻求法律建议。

### 查找联系方式

报告漏洞的第一步是找到适当的报告对象。尽管一些组织已明确发布披露政策，但许多组织没有，因此很难找到正确的报告渠道。

在没有明确披露政策的情况下，以下渠道可能提供联系方式：

- 漏洞赏金计划，如 [BugCrowd](https://bugcrowd.com/programs)、[HackerOne](https://hackerone.com/directory/programs)、[huntr.dev](https://huntr.dev/bounties)、[Open Bug Bounty](https://www.openbugbounty.org) 或 [Standoff](https://bugbounty.standoff365.com)。
- 网站上根据 [RFC 9116](https://www.rfc-editor.org/rfc/rfc9116.html#name-location-of-the-securitytxt) 在 `/.well-known/security.txt` 的 [security.txt](https://securitytxt.org) 文件。
- 现有的问题跟踪系统。
- 通用电子邮件地址，如 `security@` 或 `abuse@`。
- 网站上的通用"联系我们"页面。
- 社交媒体平台。
- 致电组织。
- 联系社区。

在联系非专门的安全联系人时，请要求相关工作人员的详细信息，而不是向最初接触的人（尤其是在社交媒体上）披露漏洞详情。

如果无法直接联系组织，国家或行业基础的 [CERT](https://en.wikipedia.org/wiki/Computer_emergency_response_team) 可能能够提供帮助。

### 初始报告

一旦确定了安全联系人，就应报告漏洞的详情。理想情况下，这应通过加密信道（如使用 PGP 密钥）完成，尽管许多组织不支持此方法。

初始报告应包括：

- 足够的漏洞细节，以便理解和重现。
- HTTP 请求和响应、HTML 片段、屏幕截图或任何其他支持性证据。
    - 在报告前删除任何个人数据。
    - 一些组织可能会试图声称漏洞从未存在，因此确保有足够证据证明它们确实存在。
- 概念验证代码（如果可用）。
- 漏洞的影响。
- 任何适当的参考或进一步阅读。

在许多情况下，尤其是在较小的组织中，安全报告可能由没有安全背景的开发人员或 IT 人员处理。这意味着他们可能不熟悉许多安全概念或术语，因此报告应使用清晰简单的语言。

提供关于如何缓解或解决问题的建议可能也很有益。但是，除非了解系统或应用程序的详细信息，或者对建议非常有信心，否则最好将开发人员指向一些更通用的指导（如 OWASP 备忘录）。

如果计划在一段时间后发布漏洞详情（根据某些[负责任披露](#负责任或协调披露)政策），则应在初始电子邮件中明确沟通 - 但要以不会听起来具有威胁性的语气进行。

如果组织没有建立漏洞赏金计划，则在初次联系中避免询问付款或奖励 - 等到问题被确认（或理想情况下已修复）。特别是，**不要在透露漏洞详情之前要求付款**。这看起来至少像是试图欺骗公司，最坏的情况可能构成敲诈。

### 持续沟通

虽然简单的漏洞可能仅通过初始报告得到解决，但在许多情况下，研究人员和组织之间会有多封来回邮件。对于更复杂的漏洞，开发人员或管理员可能会要求提供额外信息或关于如何解决问题的建议。他们还可能要求协助在实施修复后重新测试问题。尽管没有义务进行此重新测试，但只要请求合理，提供关于修复的反馈就非常有益。

如果组织变得无响应，或者接近公开披露漏洞的既定截止日期，可能需要跟进。确保沟通保持专业和积极 - 如果披露过程变得敌对，双方都不会受益。

如果问题解决需要一段时间，请保持耐心。开发人员可能受到组织内不同人员的巨大压力，可能无法完全公开地沟通。在企业环境中，分类、开发、审查、测试和部署修复所需的时间**明显**比大多数研究人员预期的要长，不断催促更新只会给开发人员增加另一层压力。

### 何时放弃

尽管您做出了每一项努力，但有些组织对安全不感兴趣，无法联系，或可能对研究人员披露漏洞持积极敌对态度。在某些情况下，他们甚至可能威胁对研究人员采取法律行动。当这种情况发生时，对研究人员来说非常令人沮丧 - 重要的是不要将此视为个人攻击。发生这种情况时，可以采取以下几种选择。

- 公开披露漏洞，并处理任何负面反应，甚至可能面临诉讼。他们是否有强有力的法律依据无关紧要 - 他们有昂贵的律师，而且打任何法律诉讼都是昂贵且耗时的。在采取这种方式之前，问问自己：_这真的值得吗？_
- 匿名披露漏洞。但是，如果您已经联系了组织并尝试向他们报告漏洞，那么披露背后的责任人可能相当明显。如果要采用这种方法，请确保采取了足够的操作安全措施来保护自己。
- 向第三方（如行业监管机构或数据保护机构）报告漏洞。
- 继续前进。

有许多组织对安全有真正的兴趣，并且对安全研究人员非常开放和合作。除非漏洞极其严重，**为了一个不在乎的组织而耗尽自己，或冒着毁掉自己的职业生涯和生计的风险是不值得的**。

### 发布

一旦漏洞被修复（或未修复），就需要就发布细节做出决定。理想情况下，这应通过与供应商讨论完成，至少应通知供应商您打算发布，并提供已发布细节的链接。披露通常包括：

- 漏洞及其影响的高级摘要。
- 哪些版本易受攻击，哪些已修复。
- 技术细节或潜在的概念验证代码。
- 缓解措施或解决方法。
- 供应商已发布公告的链接。
- 发现、与供应商沟通和发布的时间线。

一些组织可能会要求您完全不发布细节，或延迟发布以给用户更多时间安装安全补丁。为了维护与组织的良好关系，值得尝试找到一个折中的立场。

是否发布可工作的概念验证（或功能性利用代码）是一个有争议的话题。一些人会认为这是不道德的举动，并争论这样做直接帮助犯罪分子危害他们的用户。另一方面，这些代码可以被系统管理员和渗透测试人员用于测试他们的系统，而且如果漏洞足够有价值，攻击者将能够开发或逆向工程可用的利用代码。

如果您在敌对环境中发布细节（如无响应的组织，或在声明的时间段过后），您可能面临威胁甚至法律诉讼。是否有任何法律依据将取决于您的司法管辖区，以及您是否与组织签署了任何形式的保密协议。在这样做之前，请确保了解您的法律立场。

请注意，许多漏洞赏金计划禁止研究人员在未经组织同意的情况下发布细节。如果您选择这样做，可能会丧失赏金或被平台禁止 - 因此在发布前请阅读计划规则。

## 接收漏洞报告

本节旨在为组织提供如何接受和接收漏洞报告的指导。

### 漏洞赏金计划

漏洞赏金计划通过提供奖励，激励研究人员识别和报告组织的漏洞。这些奖励通常是金钱，但也可以是实物（纪念品）。该过程通常由 [BugCrowd](https://bugcrowd.com/programs) 或 [HackerOne](https://hackerone.com/directory/programs) 等第三方管理，他们在研究人员和组织之间提供调解。

在实施漏洞赏金计划时，需要明确定义以下领域：

- 哪些系统和应用程序在范围内。
    - 是实时系统还是暂存/UAT 环境？
    - 排除第三方管理或拥有的系统。
- 哪些类型的漏洞有资格获得赏金（SSL/TLS 问题？缺少 HTTP 安全标头？版本披露？）
- 诸如安全港政策等法律条款。
    - [disclose.io](https://disclose.io) 项目提供了一些示例政策。
    - 请从律师那里获得法律建议，**而不是从这个备忘录**。
- 赏金的金额以及如何决定。
    - 如果识别出大量漏洞，该计划可能变得非常昂贵。
    - 奖励太少，研究人员可能不会理会该计划。
- 初始响应、确认、支付和问题解决的时间线。

#### 何时实施漏洞赏金计划

微软等许多大型组织已采用漏洞赏金计划，并开始在商业部门之外使用，包括美国国防部。然而，对于较小的组织来说，它们可能带来重大挑战，并需要大量时间和资源投入。这些挑战包括：

- 有足够的时间和资源来响应报告。
- 拥有足够熟练的员工有效地对报告进行分类。
    - 报告可能包含大量垃圾或误报。
    - 托管的漏洞赏金计划可能通过执行初步分类来提供帮助（需要付费）。
- 处理大量误报和垃圾报告。
- 个人测试实时系统的影响（包括运行他们不理解的自动化工具的非熟练攻击者）。
- 无法区分合法测试流量和恶意攻击。
- 研究人员超出范围并测试不应测试的系统。
- 运行计划的财务成本（一些公司每年在赏金上支出数十万美元）。
- 处理对计划运作方式不满的研究人员（如争议赏金金额，或对报告的问题是重复或超出范围感到愤怒）。

尽管存在这些潜在问题，漏洞赏金计划是识别应用程序和系统中漏洞的好方法。但是，只有已经拥有成熟的漏洞披露流程，并有强大的内部流程支持解决漏洞的组织，才应使用这些计划。

### 发布联系方式

流程中最重要的步骤是为安全研究人员提供联系您组织的方式。越容易联系，收到安全报告的可能性就越大。以下列表包括一些常用机制 - 您实施的越多越好：

- "联系我们"页面上的专门安全联系人。
- 错误跟踪器上报告安全问题的专门说明。
- 常用的 `security@` 电子邮件地址。
- 根据 [RFC 9116](https://www.rfc-editor.org/rfc/rfc9116.html#name-location-of-the-securitytxt) 在网站 `/.well-known/security.txt` 处的 [security.txt](https://securitytxt.org) 文件。
- 使用第三方[漏洞赏金](#漏洞赏金计划)计划。

确保一线员工（如监控主要联系地址、网页聊天和电话线路的人员）了解如何处理安全问题报告，以及向组织内部谁报告这些问题。

#### 提供报告指南

除了联系方式，还应提供一些研究人员在报告漏洞时遵循的指南。这些可能包括：

- 请求可帮助确认和解决问题的具体信息。
- 在错误跟踪器上使用特定类别或将问题标记为保密。
- 提供用于加密通信的 PGP 密钥。
- 建立初始响应和分类的时间线。
- 建立安全港条款。

### 与研究人员沟通

研究人员和组织之间的沟通往往是漏洞披露过程中最困难的点，很容易使双方对流程感到沮丧和不满。

下面概述了理想的通信流程：

- 对初始联系方式请求以明确机制回复，让研究人员提供更多信息。
- 确认漏洞细节并提供执行分类的时间线。
- 在需要时请求额外澄清或细节。
- 确认漏洞并提供实施修复的时间线。
    - 确认任何奖励或赏金的细节。
- 如果需要，请研究人员重新测试漏洞。
- 确认漏洞已解决。

在整个过程中，提供当前状态的定期更新，以及分类和修复漏洞的预期时间线。即使没有这些的明确时间线，持续的沟通也能提供一些保证，表明漏洞没有被遗忘。

#### 研究人员要求付款

一些个人可能会接近组织，声称发现了漏洞，并要求在共享细节之前付款。尽管这些请求_可能_是合法的，但在许多情况下它们只是骗局。

一种选择是要求他们通过调解的漏洞赏金平台进行披露，这可以为双方提供一定程度的保护，因为骗子不太可能愿意使用这些平台。

### 披露

#### 商业和开源软件

一旦漏洞被解决（并重新测试），应在软件的安全公告中发布细节。重要的是要记住，发布安全问题的细节**并不会使供应商看起来很糟**。所有软件都有安全漏洞，展示处理和披露它们的明确和既定流程，比试图隐藏问题能给软件安全性带来更多信心。

安全公告至少必须包含：

- 漏洞的高级摘要，包括影响。
- 易受攻击版本的明确列表。
- 补丁版本的明确列表。
- 软件易受攻击的任何注意事项（例如，只有某些配置受影响）。
- 可作为临时修复实施的任何解决方法或缓解措施。
- 漏洞的 [CVE](https://cve.mitre.org/cve/request_id.html)。

如果可能，还应包括：

- 漏洞披露流程的时间线。
- 识别漏洞的研究人员的致谢。
- 漏洞的技术细节。
- IDS/IPS 签名或其他妥协指标。

安全公告应该易于开发人员和系统管理员找到。发布的常见方式包括：

- 网站上专门的"安全"或"安全公告"页面。
- 安全邮件列表或论坛。
- 链接到主要更新日志和发行说明。

一些研究人员可能会发布自己对漏洞的技术性写实，通常会包括利用所需的完整细节（有时甚至包括可工作的利用代码）。对于更严重的漏洞，要求研究人员延迟发布全部细节一段时间（如一周）可能是明智的，以便在利用代码可用之前给系统管理员更多时间安装补丁。然而，一旦发布了补丁，攻击者将能够逆向工程漏洞并开发自己的利用代码，因此延迟完全发布的价值有限。

#### 私有系统

对于私有系统中的漏洞，需要决定一旦漏洞被解决是否应发布细节。大多数漏洞赏金计划给组织选择是否在问题解决后披露细节的选项，尽管通常不是必需的。

发布这些细节有助于证明组织正在采取主动和透明的安全方法，但也可能导致潜在尴尬的遗漏和错误配置被公开。在未来的入侵或数据泄露事件中，它们可能被用作组织内部安全文化薄弱的证据。此外，它们可能暴露内部技术细节，并可能帮助攻击者识别其他类似问题。因此，这个决定应该仔细评估，并可能需要寻求法律建议。

### 奖励研究人员

对于在漏洞赏金计划之外识别和报告漏洞（本质上是提供免费安全测试）的研究人员，并且在整个漏洞披露过程中表现专业和有帮助，提供某种奖励以鼓励未来这种积极互动是很好的。如果无法提供金钱奖励，则应考虑其他选择，例如：

- 组织提供的服务或产品的折扣或信用。
- 虚拟奖励（如特殊游戏内物品、自定义头像等）。
- T恤、贴纸和其他品牌物品（纪念品）。
- "名人堂"中的致谢，或其他类似的认可。

## 进一步阅读

- [CERT 协调漏洞披露指南](https://vuls.cert.org/confluence/display/CVD/The+CERT+Guide+to+Coordinated+Vulnerability+Disclosure)
- [HackerOne 漏洞披露指南](https://www.hackerone.com/disclosure-guidelines)
- [Disclose.io 漏洞披露条款](https://github.com/disclose/disclose/tree/master/terms)


